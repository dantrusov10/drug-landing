import React, { useEffect, useMemo, useRef, useState } from "react";
import { motion, useAnimation, useReducedMotion } from "framer-motion";
import {
  MapPin,
  Stethoscope,
  Activity,
  ShoppingCart,
  CheckCircle2,
  Sparkles,
  ShieldCheck,
  Star,
  Share2,
  Gift,
  HeartHandshake,
  PhoneCall,
  Globe2,
  CalendarCheck,
  MessageSquare,
  FileText,
  ChevronDown,
  Copy,
} from "lucide-react";

/**
 * ДРУГ — Лендинг (Full v3.5) | Цветовой редизайн из архива (ИНЛАЙН-ОТРИСОВКА)
 * - НИ ОДНОГО внешнего файла: логотип, иконка, фон — вектором (SVG) внутри кода
 * - Сохранено полное наполнение (hero, features, demo, gamification, partners, roadmap, blog, faq, cta, footer)
 * - Палитра: мятно‑бирюзовый бренд + тёмный графит
 */

// ===================== ПАЛИТРА =====================
const COLORS = {
  primary: "#4BD1A0", // мята
  primaryLight: "#7DEBC3",
  primaryDark: "#3AAE84",
  bg: "#E6F7F3", // светлая подложка
  dark: "#243746", // акцентный текст
};
const isBrowser = typeof window !== "undefined";
const glass = "bg-white/55 backdrop-blur-xl border border-white/40 shadow-lg shadow-black/5";

// ===================== SVG-АТОМЫ (инлайн) =====================
// 1) Глиф бесконечности (как в айдентике)
function InfinityGlyph({ fill = COLORS.primary, stroke = "none", className = "w-8 h-8" }) {
  // Контур построен так, чтобы совпадать с пропорциями выбранного знака
  return (
    <svg viewBox="0 0 200 120" className={className} aria-hidden>
      <path
        d="M50,20 C26,20 8,38 8,60 C8,82 26,100 50,100 C74,100 97,74 100,60 C103,74 126,100 150,100 C174,100 192,82 192,60 C192,38 174,20 150,20 C126,20 103,46 100,60 C97,46 74,20 50,20 Z"
        fill={fill}
        stroke={stroke}
        strokeWidth="0"
      />
    </svg>
  );
}

// 2) ЛОГОТИП (знак + слово «Друг»)
function LogoSVG({ className = "h-8" }) {
  return (
    <div className={`flex items-center gap-3 ${className}`}>
      <InfinityGlyph className="h-8 w-auto" />
      <svg viewBox="0 0 340 100" className="h-6 w-auto" aria-label="Друг логотип">
        <text x="0" y="74" fontFamily="Inter, system-ui, -apple-system, Segoe UI, Roboto" fontWeight="700" fontSize="72" fill={COLORS.dark}>
          Друг
        </text>
      </svg>
    </div>
  );
}

// 3) Иконка приложения (скевоморфная плашка с закруглением и глифом внутри)
function AppIconSVG({ size = 48, className = "" }) {
  const r = 28; // радиус скругления
  const s = size;
  return (
    <svg width={s} height={s} viewBox="0 0 200 200" className={className} aria-label="Иконка приложения">
      <defs>
        <linearGradient id="gBg" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stopColor={COLORS.primary} />
          <stop offset="100%" stopColor={COLORS.primaryDark} />
        </linearGradient>
        <linearGradient id="gGlyph" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stopColor="#FFFFFF" stopOpacity="0.9" />
          <stop offset="100%" stopColor="#FFFFFF" stopOpacity="0.75" />
        </linearGradient>
        <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
          <feGaussianBlur in="SourceAlpha" stdDeviation="6" result="blur" />
          <feOffset dy="2" />
          <feMerge>
            <feMergeNode />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>
      <rect x="10" y="10" width="180" height="180" rx="40" fill="url(#gBg)" />
      <g filter="url(#soft)">
        <path d="M50,70 C34,70 22,82 22,100 C22,118 34,130 50,130 C66,130 82,112 84,100 C86,112 104,130 120,130 C136,130 148,118 148,100 C148,82 136,70 120,70 C104,70 86,88 84,100 C82,88 66,70 50,70 Z" fill="url(#gGlyph)" />
      </g>
    </svg>
  );
}

// 4) Паттерн подложки как data:URL (повторяющийся глиф бесконечности с низким контрастом)
function makeBackgroundDataURL() {
  const tile = `
  <svg xmlns='http://www.w3.org/2000/svg' width='320' height='320' viewBox='0 0 320 320'>
    <rect width='320' height='320' fill='${COLORS.bg}'/>
    <g opacity='0.12'>
      <path d='M80 60 C56 60 38 78 38 100 C38 122 56 140 80 140 C104 140 127 114 130 100 C133 114 156 140 180 140 C204 140 222 122 222 100 C222 78 204 60 180 60 C156 60 133 86 130 100 C127 86 104 60 80 60 Z' fill='${COLORS.primary}'/>
      <path d='M240 180 C216 180 198 198 198 220 C198 242 216 260 240 260 C264 260 287 234 290 220 C293 234 316 260 340 260 C364 260 382 242 382 220 C382 198 364 180 340 180 C316 180 293 206 290 220 C287 206 264 180 240 180 Z' fill='${COLORS.primary}' transform='translate(-80,-40)'/>
    </g>
  </svg>`;
  const encoded = encodeURIComponent(tile).replace(/%20/g, " ");
  return `url("data:image/svg+xml,${encoded}")`;
}

// ===================== ФОН =====================
function MintPatternBackground() {
  const bg = makeBackgroundDataURL();
  return (
    <div
      aria-hidden
      className="fixed inset-0 -z-20 pointer-events-none"
      style={{
        backgroundColor: COLORS.bg,
        backgroundImage: bg,
        backgroundRepeat: "repeat",
        backgroundSize: "520px 520px",
      }}
    />
  );
}

// ===================== УТИЛИТЫ UI =====================
function ProgressRing({ size = 120, stroke = 10, progress = 72, label = "" }) {
  const radius = (size - stroke) / 2;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference - (progress / 100) * circumference;
  return (
    <div className="flex flex-col items-center">
      <svg width={size} height={size} className="rotate-[-90deg]" aria-label={`Прогресс ${progress}%`}>
        <circle stroke="#eef2f3" fill="transparent" strokeWidth={stroke} r={radius} cx={size / 2} cy={size / 2} />
        <circle stroke={COLORS.primary} fill="transparent" strokeLinecap="round" strokeWidth={stroke} r={radius} cx={size / 2} cy={size / 2} style={{ strokeDasharray: `${circumference} ${circumference}`, strokeDashoffset: offset }} />
      </svg>
      {label && <div className="mt-2 text-sm text-gray-700">{label}</div>}
    </div>
  );
}

function TiltCard({ children, className = "" }) {
  const ref = useRef(null);
  const frameRef = useRef(0);
  const prefersReducedMotion = useReducedMotion();
  function handleMove(e) {
    if (prefersReducedMotion) return;
    const el = ref.current; if (!el) return;
    const rect = el.getBoundingClientRect();
    const px = (e.clientX - rect.left) / rect.width;
    const py = (e.clientY - rect.top) / rect.height;
    const rotateX = (0.5 - py) * 10; const rotateY = (px - 0.5) * 10;
    cancelAnimationFrame(frameRef.current);
    frameRef.current = requestAnimationFrame(() => {
      el.style.transform = `perspective(800px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    });
  }
  function handleLeave() {
    const el = ref.current; if (!el) return;
    el.style.transform = "perspective(800px) rotateX(0) rotateY(0)";
  }
  return (
    <motion.div ref={ref} onMouseMove={handleMove} onMouseLeave={handleLeave} className={"transition-transform duration-200 will-change-transform " + className}>{children}</motion.div>
  );
}

// ===================== БЛОКИ СЕКЦИЙ =====================
function WaitlistForm({ compact = false, onSuccess }) {
  const [email, setEmail] = useState("");
  const [phone, setPhone] = useState("");
  const [messenger, setMessenger] = useState("telegram");
  const [agree, setAgree] = useState(true);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");

  const handleSubmit = (e) => {
    e.preventDefault();
    setError("");
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { setError("Введите корректный email"); return; }
    setLoading(true);
    setTimeout(() => {
      const entry = { email, phone, messenger, ts: Date.now() };
      if (isBrowser) {
        const data = JSON.parse(localStorage.getItem("drg_waitlist") || "[]");
        data.push(entry);
        localStorage.setItem("drg_waitlist", JSON.stringify(data));
      }
      setLoading(false);
      onSuccess?.(entry);
    }, 600);
  };

  return (
    <form onSubmit={handleSubmit} className={`w-full ${compact ? "grid grid-cols-1 gap-3" : "grid grid-cols-1 md:grid-cols-[1fr_auto] gap-3"}`}>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        <input type="email" required aria-label="Email" placeholder="Ваш email" className={`${glass} w-full rounded-xl px-4 py-3 text-sm placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-[${COLORS.primary}]`} value={email} onChange={(e) => setEmail(e.target.value)} />
        <input type="tel" aria-label="Телефон (опционально)" placeholder="Телефон (опционально)" className={`${glass} w-full rounded-xl px-4 py-3 text-sm placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-[${COLORS.primary}]`} value={phone} onChange={(e) => setPhone(e.target.value)} />
      </div>
      <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
        <label className={`${glass} flex items-center gap-2 rounded-xl px-3 py-2 text-sm cursor-pointer`}>
          <input type="radio" name="messenger" className="accent-[--primary]" checked={messenger === "telegram"} onChange={() => setMessenger("telegram")} /> Telegram
        </label>
        <label className={`${glass} flex items-center gap-2 rounded-xl px-3 py-2 text-sm cursor-pointer`}>
          <input type="radio" name="messenger" className="accent-[--primary]" checked={messenger === "whatsapp"} onChange={() => setMessenger("whatsapp")} /> WhatsApp
        </label>
        <label className={`${glass} flex items-center gap-2 rounded-xl px-3 py-2 text-sm col-span-2 md:col-span-1`}>
          <input type="checkbox" className="accent-[--primary]" checked={agree} onChange={(e) => setAgree(e.target.checked)} /> Получать апдейты
        </label>
      </div>
      <div className="flex items-center gap-3">
        <button type="submit" disabled={loading || !agree} className="rounded-xl px-5 py-3 text-sm font-semibold shadow-inner transition disabled:opacity-50 disabled:cursor-not-allowed" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>{loading ? "Отправка…" : "Получить ранний доступ"}</button>
        {error && <span className="text-sm text-red-600" role="alert">{error}</span>}
      </div>
      <p className="text-xs text-gray-600 mt-1">Нажимая кнопку, вы соглашаетесь с Privacy/Terms/Cookies.</p>
    </form>
  );
}

function SocialProofRow() {
  return (
    <div className="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm text-gray-700">
      <div className={`${glass} rounded-xl p-3 flex items-center gap-2`}><CheckCircle2 className="w-4 h-4 text-[--primary]" /> 10k+ вейтлист</div>
      <div className={`${glass} rounded-xl p-3 flex items-center gap-2`}><HeartHandshake className="w-4 h-4 text-[--primary]" /> Партнёры: клиники/приюты</div>
      <div className={`${glass} rounded-xl p-3 flex items-center gap-2`}><Sparkles className="w-4 h-4 text-[--primary]" /> ИИ-рекомендации</div>
    </div>
  );
}

function PersonalPanel({ refCode, coins, setCoins }) {
  const shareUrl = useMemo(() => {
    if (!isBrowser) return "";
    const url = new URL(window.location.href);
    url.searchParams.set("ref", refCode);
    return url.toString();
  }, [refCode]);
  function copy() { if (!isBrowser) return; navigator.clipboard.writeText(shareUrl); }
  return (
    <div className={`${glass} rounded-2xl p-4 mt-6`}>
      <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div className="flex items-center gap-3"><Gift className="w-5 h-5 text-[--primary]" />
          <div><div className="text-sm font-semibold">Ваша персональная панель</div><div className="text-xs text-gray-600">Делитесь ссылкой и получайте бейджи/доступ</div></div>
        </div>
        <div className="flex items-center gap-2">
          <button type="button" onClick={copy} className={`${glass} rounded-xl px-3 py-2 text-xs flex items-center gap-2`} title="Скопировать реф-ссылку"><Copy className="w-4 h-4"/>Копировать</button>
          <a target="_blank" rel="noreferrer noopener" href={`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}`} className={`${glass} rounded-xl px-3 py-2 text-xs flex items-center gap-2`}><Share2 className="w-4 h-4" />Поделиться</a>
        </div>
      </div>
      <div className="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className={`${glass} rounded-xl p-4 flex items-center gap-4`}><ProgressRing progress={72} label="Готовность к Q4 2025" /><div><div className="text-sm font-semibold">Прогресс релиза</div><div className="text-xs text-gray-600">Следите за апдейтами в блоге</div></div></div>
        <div className={`${glass} rounded-xl p-4`}><div className="text-sm font-semibold mb-2">Майлстоуны рефералов</div><ul className="text-xs text-gray-700 space-y-1"><li>1 приглашённый — бейдж “Ранний друг”</li><li>3 — “Комьюнити-гуру” + доступ в бету</li><li>5 — приоритетный доступ/перки</li></ul></div>
        <div className={`${glass} rounded-xl p-4 flex flex-col justify-between`}><div><div className="text-sm font-semibold mb-1">Друг Coins</div><div className="text-2xl font-extrabold">{coins}</div><div className="text-xs text-gray-600">Копите до релиза — применим в приложении</div></div><button type="button" onClick={() => setCoins((c) => c + (Math.random() > 0.5 ? 5 : 1))} className="mt-3 rounded-xl px-4 py-2 text-xs font-semibold" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>Крутить колесо удачи</button></div>
      </div>
    </div>
  );
}

function FeatureCard({ icon: Icon, title, bullets }) {
  return (
    <TiltCard className={`${glass} rounded-2xl p-5 h-full`}>
      <div className="flex items-center gap-3 mb-2">
        <div className="w-10 h-10 rounded-xl bg-white/70 flex items-center justify-center"><Icon className="w-5 h-5 text-[--primary]" /></div>
        <div className="font-semibold">{title}</div>
      </div>
      <ul className="text-sm text-gray-700 list-disc list-inside space-y-1">{bullets.map((b, i) => <li key={i}>{b}</li>)}</ul>
    </TiltCard>
  );
}

function Demo() {
  const tabs = [
    { key: "map", label: "Карта", icon: MapPin },
    { key: "telemed", label: "Телемедицина", icon: Stethoscope },
    { key: "health", label: "Дневник", icon: Activity },
    { key: "prices", label: "Цены", icon: ShoppingCart },
  ];
  const [active, setActive] = useState("map");
  return (
    <div className={`${glass} rounded-2xl p-4`}>
      <div className="flex flex-wrap gap-2 mb-4">{tabs.map((t) => (
        <button key={t.key} type="button" onClick={() => setActive(t.key)} className={`px-3 py-2 rounded-xl text-sm flex items-center gap-2 ${active === t.key ? "bg-white/80" : "bg-white/40"}`} aria-pressed={active===t.key}>
          <t.icon className="w-4 h-4" /> {t.label}
        </button>
      ))}</div>
      <div className="rounded-xl overflow-hidden bg-white/70 min-h-[220px] grid place-items-center">
        {active === "map" && (
          <div className="w-full h-full p-4 grid grid-cols-3 gap-3">
            <div className="col-span-2 rounded-xl bg-gradient-to-br from-white/70 to-white/20 grid grid-cols-6 grid-rows-6 gap-1 p-2">
              {[...Array(12)].map((_, i) => <div key={i} className="col-span-2 row-span-2 rounded-lg bg-[rgba(75,209,160,0.18)]" />)}
            </div>
            <div className="flex flex-col gap-2">
              {["Клиники", "Парки", "Груминг", "Площадки"].map((f, idx) => (
                <label key={f} className="flex items-center gap-2 text-sm bg-white/60 rounded-lg px-3 py-2">
                  <input type="checkbox" defaultChecked={idx<2} className="accent-[--primary]" /> {f}
                </label>
              ))}
            </div>
          </div>
        )}
        {active === "telemed" && (
          <div className="w-full p-4 grid grid-cols-3 gap-3">
            <div className="col-span-2 bg-white/80 rounded-xl p-3"><div className="text-xs text-gray-600 mb-2">Видеоконсультация</div><div className="aspect-video rounded-lg bg-black/60" /></div>
            <div className="bg-white/60 rounded-xl p-3 flex flex-col gap-2">
              {[1,2,3].map((i) => <div key={i} className="rounded-lg bg-white/80 p-2 text-xs">Врач #{i}: консультирует…</div>)}
              <a href="#cta" className="mt-auto rounded-lg px-3 py-2 text-xs font-semibold text-center" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>Задать вопрос</a>
            </div>
          </div>
        )}
        {active === "health" && (
          <div className="w-full p-4 grid grid-cols-3 gap-3">
            {["Вес","Активность","Прививки"].map((name,i)=>(
              <div key={i} className="bg-white/80 rounded-xl p-3">
                <div className="text-xs text-gray-600 mb-2">{name}</div>
                <div className="h-24 rounded-lg bg-[rgba(75,209,160,0.12)]" />
              </div>
            ))}
          </div>
        )}
        {active === "prices" && (
          <div className="w-full p-4 grid grid-cols-2 gap-3">
            {["Сухой корм","Лакомства","Поводок","Витамины"].map((p,i)=>(
              <div key={i} className="bg-white/80 rounded-xl p-3">
                <div className="text-sm font-medium mb-1">{p}</div>
                <div className="text-xs text-gray-600">Где дешевле: сравнение маркетплейсов</div>
                <div className="mt-2 h-8 rounded-lg bg-gradient-to-r from-white to-[rgba(75,209,160,0.35)]" />
              </div>
            ))}
          </div>
        )}
      </div>
      <div className="mt-4 flex flex-wrap items-center gap-3">
        <a href="#cta" className="rounded-xl px-4 py-2 text-sm font-semibold" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>Попробовать демо</a>
        <span className="text-xs text-gray-600">или</span>
        <a href="#cta" className="text-sm underline decoration-dotted">Записаться в ранний доступ</a>
      </div>
    </div>
  );
}

function PhoneMockup() {
  return (
    <div className="relative w-[260px] h-[520px] rounded-[36px] border border-white/60 bg-white/30 backdrop-blur-2xl shadow-2xl overflow-hidden" aria-label="Превью приложения">
      <div className="absolute inset-0 bg-gradient-to-br from-white/60 via-white/20 to-white/10" />
      <div className="relative z-10 p-4 h-full flex flex-col gap-3">
        <div className="flex items-center gap-2">
          <div className="w-8 h-8 rounded-[18px] bg-white/80 flex items-center justify-center overflow-hidden">
            <AppIconSVG size={28} />
          </div>
          <div className="text-sm font-semibold">Друг</div>
        </div>
        <div className="flex-1 grid grid-rows-[1fr_auto]">
          <div className="grid grid-cols-2 gap-3">
            <div className={`${glass} rounded-2xl p-3 flex flex-col gap-2 min-h-[110px]`}>
              <div className="flex items-center gap-2">
                <MapPin className="w-4 h-4 text-[--primary]" />
                <span className="text-xs font-medium">Карта</span>
              </div>
              <div className="text-[10px] text-gray-700">Клиники, площадки, груминг</div>
              <div className="h-8 rounded-lg bg-gradient-to-r from-[rgba(75,209,160,0.35)] to-[rgba(58,174,132,0.25)]" />
            </div>
            <div className={`${glass} rounded-2xl p-3 flex flex-col gap-2 min-h-[110px]`}>
              <div className="flex items-center gap-2">
                <Stethoscope className="w-4 h-4 text-[--primary]" />
                <span className="text-xs font-medium">Телемед</span>
              </div>
              <div className="text-[10px] text-gray-700">Чат и видео с врачом</div>
              <div className="flex items-center gap-1 mt-auto" aria-hidden>
                <div className="w-6 h-6 rounded-full bg-white/70" />
                <div className="w-6 h-6 rounded-full bg-white/50" />
                <div className="w-6 h-6 rounded-full bg-white/40" />
              </div>
            </div>
            <div className={`${glass} rounded-2xl p-3 col-span-2 min-h-[120px]`}>
              <div className="flex items-center gap-2 mb-1">
                <Activity className="w-4 h-4 text-[--primary]" />
                <span className="text-xs font-medium">Здоровье</span>
              </div>
              <div className="grid grid-cols-3 gap-2 text-[10px] text-gray-700">
                <div className="flex flex-col items-center">
                  <div className="w-12 h-12 rounded-full bg-white/60 flex items-center justify-center text-[--primary] font-semibold">3.9км</div>
                  <span>Активность</span>
                </div>
                <div className="flex flex-col items-center">
                  <div className="w-12 h-12 rounded-full bg-white/60 flex items-center justify-center text-[--primary] font-semibold">24.8</div>
                  <span>Вес</span>
                </div>
                <div className="flex flex-col items-center">
                  <div className="w-12 h-12 rounded-full bg-white/60 flex items-center justify-center text-[--primary] font-semibold">✔︎</div>
                  <span>Прививки</span>
                </div>
              </div>
            </div>
            <div className={`${glass} rounded-2xl p-3 col-span-2`}>
              <div className="flex items-center gap-2 mb-1">
                <ShoppingCart className="w-4 h-4 text-[--primary]" />
                <span className="text-xs font-medium">Покупки</span>
              </div>
              <div className="text-[10px] text-gray-700">Сравнение цен · Подписки</div>
              <div className="mt-2 h-8 rounded-lg bg-gradient-to-r from-[rgba(75,209,160,0.35)] to-[rgba(58,174,132,0.25)]" />
            </div>
          </div>
          <div className="mt-3 text-center text-[10px] text-gray-700">“Мы на 72% к релизу Q4 2025”</div>
        </div>
      </div>
      <div className="absolute -top-12 -left-10 w-48 h-48 rounded-full bg-white/50 blur-2xl" aria-hidden />
      <div className="absolute -bottom-10 -right-10 w-48 h-48 rounded-full bg-white/30 blur-2xl" aria-hidden />
    </div>
  );
}

function Gamification({ coins, setCoins }) {
  const [pet, setPet] = useState({ name: "", breed: "", dob: "" });
  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div className={`${glass} rounded-2xl p-5`}>
        <div className="flex items-center gap-2 mb-3"><FileText className="w-5 h-5 text-[--primary]" /><div className="font-semibold">Pre-Passport питомца</div></div>
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <input className={`${glass} rounded-xl px-3 py-2 text-sm`} placeholder="Имя" value={pet.name} onChange={(e) => setPet({ ...pet, name: e.target.value })} />
          <input className={`${glass} rounded-xl px-3 py-2 text-sm`} placeholder="Порода" value={pet.breed} onChange={(e) => setPet({ ...pet, breed: e.target.value })} />
          <input className={`${glass} rounded-xl px-3 py-2 text-sm`} type="date" value={pet.dob} onChange={(e) => setPet({ ...pet, dob: e.target.value })} />
          <button type="button" onClick={() => setCoins((c)=>c+3)} className="rounded-xl px-4 py-2 text-sm font-semibold" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>Сохранить</button>
        </div>
        <div className="mt-4 grid grid-cols-1 sm:grid-cols-[auto_1fr] gap-4 items-center">
          <div className="w-28 h-36 rounded-2xl bg-white/70 grid place-items-center overflow-hidden"><AppIconSVG size={40} /></div>
          <div>
            <div className="font-semibold">Мини-паспорт</div>
            <div className="text-sm text-gray-700">{pet.name || "Имя"} · {pet.breed || "Порода"} · {pet.dob || "дата рождения"}</div>
            <div className="text-xs text-gray-600">Сохранится в приложении при релизе</div>
          </div>
        </div>
      </div>
      <div className="space-y-6">
        <div className={`${glass} rounded-2xl p-5`}>
          <div className="flex items-center gap-2 mb-3"><CalendarCheck className="w-5 h-5 text-[--primary]" /><div className="font-semibold">Недельные челленджи</div></div>
          <ul className="space-y-2 text-sm">
            {[{ t: "5 прогулок на неделе", r: 2 }, { t: "Фото-проверка ушей после купания", r: 2 }].map((c, i) => (
              <li key={i} className="flex items-center gap-2">
                <input type="checkbox" className="accent-[--primary]" onChange={(e) => e.target.checked && setCoins((v)=>v + c.r)} />
                <span>{c.t}</span>
                <span className="ml-auto text-xs text-gray-600">+{c.r} Coins</span>
              </li>
            ))}
          </ul>
        </div>
        <div className={`${glass} rounded-2xl p-5`}>
          <div className="flex items-center gap-2 mb-3"><MessageSquare className="w-5 h-5 text-[--primary]" /><div className="font-semibold">Mini-Quiz</div></div>
          <div className="text-sm text-gray-700 mb-3">Подобрать рацион/маршрут — 5 вопросов</div>
          <button type="button" onClick={() => setCoins((c)=>c+3)} className="rounded-xl px-4 py-2 text-sm font-semibold" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>Пройти мини-опрос</button>
        </div>
      </div>
    </div>
  );
}

function Partners() {
  const logos = ["Клиника А", "Приют B", "Клиника C", "Приют D", "Центр E", "Фонд F"];
  return (
    <div className={`${glass} rounded-2xl p-5`}>
      <div className="text-sm font-semibold mb-3">Партнёры</div>
      <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">{logos.map((name, i) => <div key={i} className="h-12 rounded-xl bg-white/70 grid place-items-center text-xs text-gray-700 uppercase tracking-wider">{name}</div>)}</div>
    </div>
  );
}

function Roadmap() {
  const items = [ { t: "MVP", p: 85 }, { t: "Beta", p: 45 }, { t: "GA", p: 10 } ];
  return (
    <div className={`${glass} rounded-2xl p-5`}>
      <div className="text-sm font-semibold mb-4">Roadmap и прозрачность</div>
      <div className="grid gap-3">{items.map((i, idx) => (
        <div key={idx}>
          <div className="flex items-center justify-between text-sm mb-1"><span>{i.t}</span><span className="text-gray-600">{i.p}%</span></div>
          <div className="h-2 rounded-full bg-white/50 overflow-hidden"><div className="h-full" style={{ width: `${i.p}%`, background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})` }} /></div>
        </div>
      ))}</div>
      <div className="mt-4"><a href="#blog" className="text-sm underline decoration-dotted">Подписаться на апдейты</a></div>
    </div>
  );
}

function BlogTeaser() {
  const posts = [
    { t: "Как выбрать корм по возрасту", tag: "питание" },
    { t: "Чеклист ухода после прогулки", tag: "уход" },
    { t: "Топ-площадки города для собак", tag: "тренировки" },
    { t: "Исследование: телемедицина для питомцев", tag: "исследования" },
  ];
  return (
    <div id="blog-list" className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">{posts.map((p, i) => (
      <a key={i} href="/blog" className={`${glass} rounded-2xl p-4 hover:shadow-xl transition shadow-black/10`}>
        <div className="text-xs uppercase tracking-wide text-gray-600 mb-1">{p.tag}</div>
        <div className="font-semibold">{p.t}</div>
        <div className="mt-3 h-20 rounded-xl bg-white/60" aria-hidden />
      </a>
    ))}</div>
  );
}

function FAQ() {
  const q = [
    { q: "Когда релиз?", a: "Планируем Q4 2025. Подпишитесь на апдейты и получите ранний доступ." },
    { q: "Как работает телемедицина?", a: "Это консультационные сервисы и советы. Не замена экстренной помощи." },
    { q: "Сколько стоит?", a: "Бесплатный базовый план; премиум по подписке. Детали ближе к релизу." },
    { q: "Безопасность данных?", a: "Храним согласно лучшим практикам. Используем минимально необходимые данные." },
    { q: "География и устройства?", a: "RU как база, затем EN/PL. iOS/Android/Web." },
    { q: "Как работать приютам/заводчикам?", a: "Предусмотрены кабинеты и прозрачность визитов/документов." },
  ];
  const [open, setOpen] = useState(null);
  return (
    <div className="space-y-2">{q.map((item, i) => (
      <div key={i} className={`${glass} rounded-xl`}>
        <button type="button" onClick={() => setOpen(open === i ? null : i)} className="w-full flex items-center justify-between text-left px-4 py-3" aria-expanded={open===i}>
          <span className="font-medium text-sm">{item.q}</span>
          <ChevronDown className={`w-4 h-4 transition ${open === i ? "rotate-180" : ""}`} />
        </button>
        {open === i && (<div className="px-4 pb-4 text-sm text-gray-700">{item.a}</div>)}
      </div>
    ))}</div>
  );
}

// ===================== APP ROOT =====================
export default function App() {
  useEffect(() => {
    if (!isBrowser) return;
    const root = document.documentElement;
    root.style.setProperty("--primary", COLORS.primary);
    root.style.setProperty("--dark", COLORS.dark);
    root.style.scrollBehavior = "smooth";
  }, []);

  const [joined, setJoined] = useState(false);
  const [coins, setCoins] = useState(() => (isBrowser ? Number(localStorage.getItem("drg_coins") || 0) : 0));
  const myRef = (isBrowser && (localStorage.getItem("drg_my_ref") || "DRG-XXXXXX"));
  useEffect(() => { if (isBrowser) localStorage.setItem("drg_coins", String(coins)); }, [coins]);

  const heroControls = useAnimation();
  const heroRef = useRef(null);
  useEffect(() => {
    if (!isBrowser) return;
    const io = new IntersectionObserver((entries) => entries.forEach((e) => e.isIntersecting && heroControls.start({ opacity: 1, y: 0 })), { threshold: 0.2 });
    if (heroRef.current) io.observe(heroRef.current);
    return () => io.disconnect();
  }, [heroControls]);

  return (
    <div className="min-h-screen text-[--dark] relative overflow-x-clip">
      <MintPatternBackground />

      {/* Header */}
      <header className="sticky top-0 z-40 backdrop-blur-md bg-white/70 border-b border-white/60">
        <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
          <LogoSVG />
          <nav className="hidden md:flex items-center gap-4 text-sm">
            <a href="#features" className="hover:underline">Преимущества</a>
            <a href="#demo" className="hover:underline">Демо</a>
            <a href="#gamification" className="hover:underline">Геймификация</a>
            <a href="#partners" className="hover:underline">Партнёры</a>
            <a href="#roadmap" className="hover:underline">Roadmap</a>
            <a href="#blog" className="hover:underline">Блог</a>
            <a href="#faq" className="hover:underline">FAQ</a>
          </nav>
          <a href="#cta" className="rounded-xl px-3 py-2 text-sm font-semibold" style={{ background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.primaryDark})`, color: "white" }}>Ранний доступ</a>
        </div>
      </header>

      {/* Hero */}
      <section id="hero" ref={heroRef} className="relative py-12 md:py-20">
        <div className="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={heroControls} transition={{ duration: 0.6 }}>
            <h1 className="text-3xl md:text-5xl font-extrabold leading-tight">Друг — приложение для заботы о питомце</h1>
            <p className="mt-3 text-lg md:text-xl text-gray-700">Карта мест, телемедицина, дневник здоровья, сравнение цен и комьюнити — всё в одном.</p>
            <div className="mt-6"><WaitlistForm onSuccess={() => setJoined(true)} /><SocialProofRow /></div>
            {joined && <PersonalPanel refCode={myRef} coins={coins} setCoins={setCoins} />}
          </motion.div>
          <motion.div initial={{ opacity: 0, y: 20 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true }} transition={{ duration: 0.6 }} className="grid place-items-center"><TiltCard><PhoneMockup /></TiltCard></motion.div>
        </div>
      </section>

      {/* Features */}
      <section id="features" className="bg-gradient-to-b from-white/60 to-[rgba(75,209,160,0.12)] py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className="mb-6 flex items-center gap-2"><Star className="w-5 h-5 text-[--primary]" /><h2 className="text-2xl md:text-3xl font-bold">За что любить</h2></div>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <FeatureCard icon={MapPin} title="Карта мест" bullets={["Клиники, парки, груминг, площадки", "Фильтры и рейтинги"]} />
            <FeatureCard icon={Stethoscope} title="Телемедицина" bullets={["Чат + видео", "Быстрые советы"]} />
            <FeatureCard icon={Activity} title="Дневник и здоровье" bullets={["Вес, активность, прививки", "Паспорт питомца"]} />
            <FeatureCard icon={ShoppingCart} title="Маркетплейсы и цены" bullets={["Где дешевле", "Подписки"]} />
          </div>
        </div>
      </section>

      {/* Demo */}
      <section id="demo" className="bg-gradient-to-b from-[rgba(75,209,160,0.12)] to-white/60 py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className="mb-6 flex items-center gap-2"><PhoneCall className="w-5 h-5 text-[--primary]" /><h2 className="text-2xl md:text-3xl font-bold">Интерактив-демо</h2></div>
          <Demo />
        </div>
      </section>

      {/* Gamification */}
      <section id="gamification" className="bg-gradient-to-b from-white/60 to-[rgba(75,209,160,0.12)] py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className="mb-6 flex items-center gap-2"><ShieldCheck className="w-5 h-5 text-[--primary]" /><h2 className="text-2xl md:text-3xl font-bold">Геймификация и миссии</h2></div>
          <Gamification coins={coins} setCoins={setCoins} />
        </div>
      </section>

      {/* Partners & Social Proof */}
      <section id="partners" className="bg-gradient-to-b from-[rgba(75,209,160,0.12)] to-white/60 py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div className="lg:col-span-2"><Partners /></div>
          <div className={`${glass} rounded-2xl p-5`}>
            <div className="text-sm font-semibold mb-3">Доверяют заводчики и ветврачи</div>
            <div className="space-y-3 text-sm text-gray-700">
              <div className={`${glass} rounded-xl p-3`}><em>“Телемедицина помогла быстрее сориентироваться, а дневник — не забыть про прививки.”</em> — Владелица хаски</div>
              <div className={`${glass} rounded-xl p-3`}><em>“Карта площадок с фильтрами — супер для активного режима.”</em> — Тренер по ОКД</div>
              <div className={`${glass} rounded-xl p-3`}><em>“Сравнение цен экономит бюджет приюта.”</em> — Куратор приюта</div>
            </div>
          </div>
        </div>
      </section>

      {/* Roadmap */}
      <section id="roadmap" className="bg-gradient-to-b from-white/60 to-[rgba(75,209,160,0.12)] py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4"><Roadmap /></div>
      </section>

      {/* Blog */}
      <section id="blog" className="bg-gradient-to-b from-[rgba(75,209,160,0.12)] to-white/60 py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className="mb-6 flex items-center gap-2"><Globe2 className="w-5 h-5 text-[--primary]" /><h2 className="text-2xl md:text-3xl font-bold">Журнал</h2></div>
          <BlogTeaser />
        </div>
      </section>

      {/* FAQ */}
      <section id="faq" className="bg-gradient-to-b from-white/60 to-[rgba(75,209,160,0.12)] py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className="mb-6 flex items-center gap-2"><MessageSquare className="w-5 h-5 text-[--primary]" /><h2 className="text-2xl md:text-3xl font-bold">FAQ</h2></div>
          <FAQ />
        </div>
      </section>

      {/* CTA */}
      <section id="cta" className="bg-gradient-to-b from-[rgba(75,209,160,0.12)] to-white/60 py-12 md:py-16">
        <div className="max-w-6xl mx-auto px-4">
          <div className={`${glass} rounded-2xl p-6 md:p-10 grid grid-cols-1 md:grid-cols-3 gap-6 items-center`}>
            <div className="md:col-span-2">
              <h3 className="text-xl md:text-2xl font-bold">Присоединяйтесь к вейтлисту</h3>
              <p className="text-sm text-gray-700 mt-1">Ранний доступ, бейджи и “Друг Coins”. Приватность соблюдаем.</p>
            </div>
            <div className="md:col-span-1">
              <WaitlistForm compact onSuccess={() => isBrowser && window.scrollTo({ top: 0, behavior: 'smooth' })} />
            </div>
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="border-t border-white/60 bg-white/80 backdrop-blur-md relative z-10">
        <div className="max-w-6xl mx-auto px-4 py-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-sm">
          <div>
            <div className="flex items-center gap-2 mb-2"><LogoSVG /></div>
            <p className="text-gray-700">Единая экосистема для жизни с питомцем: карта, телемедицина, дневник, покупки и комьюнити.</p>
          </div>
          <div>
            <div className="font-semibold mb-2">Навигация</div>
            <ul className="space-y-1">
              <li><a href="#features" className="hover:underline">Преимущества</a></li>
              <li><a href="#demo" className="hover:underline">Демо</a></li>
              <li><a href="#gamification" className="hover:underline">Геймификация</a></li>
              <li><a href="#partners" className="hover:underline">Партнёры</a></li>
              <li><a href="#faq" className="hover:underline">FAQ</a></li>
              <li><a href="#cta" className="hover:underline">Вейтлист</a></li>
            </ul>
          </div>
          <div>
            <div className="font-semibold mb-2">Юридическое</div>
            <ul className="space-y-1">
              <li><a href="/privacy" className="hover:underline">Privacy</a></li>
              <li><a href="/terms" className="hover:underline">Terms</a></li>
              <li><a href="/cookies" className="hover:underline">Cookies</a></li>
              <li><a href="/press" className="hover:underline">Press Kit</a></li>
            </ul>
          </div>
          <div>
            <div className="font-semibold mb-2">Контакты</div>
            <ul className="space-y-1">
              <li>Партнёры: <a href="mailto:partner@drug.app" className="underline">partner@drug.app</a></li>
              <li>Пресса: <a href="mailto:press@drug.app" className="underline">press@drug.app</a></li>
              <li>Соцсети: <a href="#" className="underline">@drug_app</a></li>
            </ul>
          </div>
        </div>
        <div className="text-xs text-gray-600 text-center pb-6">© {new Date().getFullYear()} Друг. Все права защищены.</div>
      </footer>
    </div>
  );
}
